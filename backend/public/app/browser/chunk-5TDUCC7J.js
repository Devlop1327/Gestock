import{a as N,b as B}from"./chunk-EEGX32CY.js";import{p as T}from"./chunk-7YMBZQR7.js";import{a as j}from"./chunk-RA2M532G.js";import{$ as I,D as f,G as l,H as P,I as i,J as o,K as _,L as h,M as m,N as p,O as r,P as v,Q as x,S as E,T as C,U as w,V as y,aa as F,ba as O,ca as M,da as L,g as S,ia as A,la as V,q as u,r as g,w as c,y as b,z as k}from"./chunk-G2FCS2CP.js";import"./chunk-2NFLSA4Y.js";var R=(a,e)=>({"badge bg-danger":a,"badge bg-success":e}),$=(a,e)=>({"badge bg-success":a,"badge bg-secondary":e}),q=()=>[];function z(a,e){a&1&&(i(0,"div",16)(1,"div",17)(2,"span",18),r(3,"Cargando..."),o()(),i(4,"p",19),r(5,"Cargando productos..."),o()())}function G(a,e){a&1&&(i(0,"tr")(1,"td",26)(2,"p",27),r(3,"No hay productos registrados"),o()()())}function H(a,e){if(a&1){let t=h();i(0,"tr")(1,"td"),r(2),o(),i(3,"td"),r(4),o(),i(5,"td"),r(6),o(),i(7,"td"),r(8),o(),i(9,"td")(10,"span",28),r(11),o()(),i(12,"td"),r(13),w(14,"currency"),o(),i(15,"td")(16,"span",28),r(17),o()(),i(18,"td",23)(19,"button",29),m("click",function(){let d=u(t).$implicit,s=p(2);return g(s.verProducto(d.id))}),_(20,"i",30),o(),i(21,"button",31),m("click",function(){let d=u(t).$implicit,s=p(2);return g(s.editarProducto(d.id))}),_(22,"i",32),o(),i(23,"button",33),m("click",function(){let d=u(t).$implicit,s=p(2);return g(s.eliminarProducto(d.id))}),_(24,"i",34),o()()()}if(a&2){let t=e.$implicit,n=p(2);c(2),v(t.codigo),c(2),v(t.nombre),c(2),v(n.getCategoriaNombre(t.categoria_id)),c(2),v(n.getProveedorNombre(t.proveedor_id)),c(2),l("ngClass",C(11,R,t.stock<=t.stock_minimo,t.stock>t.stock_minimo)),c(),x(" ",t.stock," "),c(2),v(y(14,9,t.precio)),c(3),l("ngClass",C(14,$,t.activo,!t.activo)),c(),x(" ",t.activo?"Activo":"Inactivo"," ")}}function J(a,e){if(a&1&&(i(0,"div",20)(1,"table",21)(2,"thead",22)(3,"tr")(4,"th"),r(5,"C\xF3digo"),o(),i(6,"th"),r(7,"Nombre"),o(),i(8,"th"),r(9,"Categor\xEDa"),o(),i(10,"th"),r(11,"Proveedor"),o(),i(12,"th"),r(13,"Stock"),o(),i(14,"th"),r(15,"Precio"),o(),i(16,"th"),r(17,"Estado"),o(),i(18,"th",23),r(19,"Acciones"),o()()(),i(20,"tbody"),f(21,G,4,0,"tr",24)(22,H,25,17,"tr",25),o()()()),a&2){let t=p();c(21),l("ngIf",t.productos.length===0),c(),l("ngForOf",t.productos)}}function K(a,e){if(a&1){let t=h();i(0,"li",37)(1,"button",40),m("click",function(){let d=u(t).index,s=p(2);return g(s.aplicarFiltros(d+1))}),r(2),o()()}if(a&2){let t=e.index,n=p(2);P("active",n.paginaActual===t+1),c(2),v(t+1)}}function Q(a,e){if(a&1){let t=h();i(0,"nav",35)(1,"ul",36)(2,"li",37)(3,"button",38),m("click",function(){u(t);let d=p();return g(d.aplicarFiltros(d.paginaActual-1))}),r(4,"\xAB"),o()(),f(5,K,3,3,"li",39),i(6,"li",37)(7,"button",38),m("click",function(){u(t);let d=p();return g(d.aplicarFiltros(d.paginaActual+1))}),r(8,"\xBB"),o()()()()}if(a&2){let t=p();c(2),P("disabled",t.paginaActual===1),c(),l("disabled",t.paginaActual===1),c(2),l("ngForOf",E(7,q).constructor(t.totalPaginas)),c(),P("disabled",t.paginaActual===t.totalPaginas),c(),l("disabled",t.paginaActual===t.totalPaginas)}}var D=class a{constructor(e,t,n,d){this.productoService=e;this.categoriaService=t;this.proveedorService=n;this.router=d;this.router.events.pipe(S(s=>s instanceof A)).subscribe(s=>{(s.urlAfterRedirects==="/productos"||s.url==="/productos")&&this.aplicarFiltros()})}productos=[];productosFiltrados=[];filtro="";loading=!0;eliminandoId=null;paginaActual=1;productosPorPagina=15;categorias=[];proveedores=[];categoriaSeleccionada="";proveedorSeleccionado="";stockBajo=!1;estadoSeleccionado="";totalPaginas=1;totalProductos=0;ngOnInit(){this.cargarCategorias(),this.cargarProveedores(),this.aplicarFiltros()}cargarCategorias(){this.categoriaService.getCategorias().subscribe({next:e=>this.categorias=e,error:()=>this.categorias=[]})}cargarProveedores(){this.proveedorService.getProveedores().subscribe({next:e=>this.proveedores=e,error:()=>this.proveedores=[]})}aplicarFiltros(e=1){let t={page:e,per_page:this.productosPorPagina};this.filtro&&(t.search=this.filtro),this.categoriaSeleccionada&&(t.categoria_id=this.categoriaSeleccionada),this.proveedorSeleccionado&&(t.proveedor_id=this.proveedorSeleccionado),this.stockBajo&&(t.stock_bajo=1),this.estadoSeleccionado&&(t.estado=this.estadoSeleccionado),this.loading=!0,this.productoService.getProductosConFiltros(t).subscribe({next:n=>{this.productos=n.data,this.paginaActual=n.current_page,this.totalPaginas=n.last_page,this.totalProductos=n.total,n.per_page&&(this.productosPorPagina=n.per_page),this.loading=!1},error:()=>{this.loading=!1}})}limpiarFiltros(){this.filtro="",this.categoriaSeleccionada="",this.proveedorSeleccionado="",this.stockBajo=!1,this.estadoSeleccionado="",this.aplicarFiltros()}filtrarProductos(){let e=this.filtro.toLowerCase();this.productosFiltrados=this.productos.filter(t=>t.nombre.toLowerCase().includes(e)||t.codigo.toLowerCase().includes(e)||t.descripcion.toLowerCase().includes(e)),this.paginaActual=1}nuevoProducto(){this.router.navigate(["/productos/nuevo"])}editarProducto(e){this.router.navigate(["/productos/editar",e])}eliminarProducto(e){confirm("\xBFEst\xE1s seguro de que deseas eliminar este producto?")&&(this.eliminandoId=e,this.productoService.deleteProducto(e).subscribe({next:()=>{this.aplicarFiltros(this.paginaActual),this.eliminandoId=null},error:t=>{t.status===404?this.aplicarFiltros(this.paginaActual):alert("Error al eliminar el producto."),this.eliminandoId=null}}))}verProducto(e){this.router.navigate(["/productos/ver",e])}getCategoriaNombre(e){let t=this.categorias.find(n=>n.id===e);return t?t.nombre:"-"}getProveedorNombre(e){let t=this.proveedores.find(n=>n.id===e);return t?t.nombre:"-"}logout(){window.location.href="/login"}static \u0275fac=function(t){return new(t||a)(b(N),b(j),b(B),b(V))};static \u0275cmp=k({type:a,selectors:[["app-producto-list"]],decls:19,vars:3,consts:[[1,"navbar","navbar-expand-lg","navbar-dark","bg-primary","mb-4"],[1,"container-fluid"],[1,"navbar-brand"],[1,"ms-auto"],[1,"btn","btn-outline-light",3,"click"],[1,"bi","bi-box-arrow-right","me-1"],[1,"container"],[1,"card"],[1,"card-header","bg-white"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-1"],[1,"card-body"],["class","text-center p-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["aria-label","Paginaci\xF3n de productos","class","mt-3",4,"ngIf"],[1,"text-center","p-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-dark"],[1,"text-end"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","8",1,"text-center","p-4"],[1,"text-muted","mb-0"],[3,"ngClass"],["title","Ver",1,"btn","btn-sm","btn-info","me-1","text-white",3,"click"],[1,"bi","bi-eye"],["title","Editar",1,"btn","btn-sm","btn-warning","me-1",3,"click"],[1,"bi","bi-pencil"],["title","Eliminar",1,"btn","btn-sm","btn-danger",3,"click"],[1,"bi","bi-trash"],["aria-label","Paginaci\xF3n de productos",1,"mt-3"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"]],template:function(t,n){t&1&&(i(0,"nav",0)(1,"div",1)(2,"span",2),r(3,"Productos"),o(),i(4,"div",3)(5,"button",4),m("click",function(){return n.logout()}),_(6,"i",5),r(7," Cerrar sesi\xF3n "),o()()()(),i(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"button",10),m("click",function(){return n.nuevoProducto()}),_(13,"i",11),r(14," Nuevo Producto "),o()()(),i(15,"div",12),f(16,z,6,0,"div",13)(17,J,23,2,"div",14)(18,Q,9,8,"nav",15),o()()()),t&2&&(c(16),l("ngIf",n.loading),c(),l("ngIf",!n.loading),c(),l("ngIf",!n.loading&&n.totalPaginas>1))},dependencies:[L,I,F,O,M,T],styles:[".container[_ngcontent-%COMP%]{padding:20px}.card[_ngcontent-%COMP%]{margin-top:2rem;margin-bottom:2rem;border:none;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:1rem;background-color:#f8f9fa}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto}.table[_ngcontent-%COMP%]{margin-bottom:0;min-width:1100px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1.25rem;vertical-align:middle;white-space:nowrap}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#fff;background:#222}.table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.badge[_ngcontent-%COMP%]{font-size:.875rem;padding:.4em .8em}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem}.btn-info[_ngcontent-%COMP%]{background-color:#17a2b8;border:none;color:#fff}.btn-warning[_ngcontent-%COMP%]{background-color:#ffc107;border:none;color:#212529}.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;border:none;color:#fff}"]})};export{D as ProductoListComponent};
