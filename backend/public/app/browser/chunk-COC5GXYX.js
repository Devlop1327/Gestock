import{b as i,d as n,e as l,fa as g,h as u,i as c,l as a,o as h,pa as r}from"./chunk-G2FCS2CP.js";var p=class o{constructor(e){this.http=e;this.currentUserSubject=new i(null),this.currentUser=this.currentUserSubject.asObservable(),console.log("[AuthService] Constructor: token en localStorage:",this.token),this.token&&this.fetchCurrentUser().subscribe(t=>{console.log("[AuthService] Usuario cargado tras refresh:",t),this.currentUserSubject.next(t)})}currentUserSubject;currentUser;tokenKey="auth_token";get currentUserValue(){return this.currentUserSubject.value}get token(){let e=localStorage.getItem(this.tokenKey);return console.log("[AuthService] Getter token:",e),e&&this.isTokenValid(e)?e:(this.currentUserSubject.value&&this.logout(),null)}isAuthenticated(){let e=this.token;return console.log("Token actual:",e?"Presente":"Ausente"),e!==null}login(e){return this.http.post(`${r.apiUrl}/login`,e).pipe(c(t=>{console.log("[AuthService] Login response:",t),t.success&&t.data.token&&(localStorage.setItem(this.tokenKey,t.data.token),this.fetchCurrentUser().subscribe(s=>{console.log("[AuthService] Usuario tras login:",s),this.currentUserSubject.next(s)}))}))}logout(){console.log("Cerrando sesi\xF3n..."),localStorage.removeItem(this.tokenKey),this.currentUserSubject.next(null)}fetchCurrentUser(){let e=this.token;return console.log("[AuthService] fetchCurrentUser: token usado:",e),e?this.http.get(`${r.apiUrl}/user`).pipe(l(t=>(console.log("[AuthService] /user response:",t),t)),u(t=>(console.error("[AuthService] Error al obtener datos del usuario:",t),this.logout(),n(null)))):n(null)}getUserData(){return this.currentUserSubject.value}getUserFromStorage(){let e=localStorage.getItem(this.tokenKey);return console.log("Token en almacenamiento:",e?"Presente":"Ausente"),e&&this.isTokenValid(e),null}isTokenValid(e){return!!e}register(e){return this.http.post(`${r.apiUrl}/register`,e)}getUserRole(){return this.currentUserSubject.value?.role?.nombre||"user"}static \u0275fac=function(t){return new(t||o)(h(g))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{p as a};
