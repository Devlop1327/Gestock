import{a as Z}from"./chunk-COC5GXYX.js";import{a as ee,b as re}from"./chunk-EEGX32CY.js";import{b as R,c,d as G,e as B,f as $,g as K,h as z,i as U,j as H,k as J,l as L,m as Q,n as W,o as X,q as Y}from"./chunk-7YMBZQR7.js";import{a as te}from"./chunk-RA2M532G.js";import{D as u,G as d,H as v,I as o,J as r,K as s,L as T,M as f,N as y,O as i,P as E,Q as A,aa as D,ba as V,da as j,ja as M,la as w,q as I,r as q,w as a,y as p,z as O}from"./chunk-G2FCS2CP.js";import{a as N,b as x}from"./chunk-2NFLSA4Y.js";function ie(l,n){if(l&1){let e=T();o(0,"div",36),i(1),o(2,"button",37),f("click",function(){I(e);let m=y();return q(m.error="")}),r()()}if(l&2){let e=y();a(),A(" ",e.error," ")}}function ne(l,n){l&1&&(o(0,"div",38),i(1," El c\xF3digo es requerido "),r())}function le(l,n){l&1&&(o(0,"div",38),i(1," El nombre es requerido "),r())}function ae(l,n){l&1&&(o(0,"div",38),i(1," El precio es requerido "),r())}function de(l,n){l&1&&(o(0,"div",38),i(1," El stock es requerido "),r())}function ce(l,n){l&1&&(o(0,"div",38),i(1," El stock m\xEDnimo es requerido "),r())}function me(l,n){if(l&1&&(o(0,"option",39),i(1),r()),l&2){let e=n.$implicit;d("value",e.id),a(),E(e.nombre)}}function ue(l,n){if(l&1&&(o(0,"option",39),i(1),r()),l&2){let e=n.$implicit;d("value",e.id),a(),E(e.nombre)}}var oe=class l{constructor(n,e,t,m,b,g,_){this.fb=n;this.productoService=e;this.categoriaService=t;this.proveedorService=m;this.router=b;this.authService=g;this.route=_;this.productoForm=this.fb.group({codigo:["",[c.required]],nombre:["",[c.required]],descripcion:["",[c.required]],precio:[null,[c.required,c.min(0),c.max(1e6)]],stock:[null,[c.required,c.min(0)]],stock_minimo:[null,[c.required,c.min(0)]],categoria_id:[null,[c.required]],proveedor_id:[null,[c.required]],activo:[!0]})}categorias=[];proveedores=[];nuevaCategoria(){this.router.navigate(["/categorias/nueva"])}nuevoProveedor(){this.router.navigate(["/proveedores/nuevo"])}productoForm;submitting=!1;error="";idProducto;esEdicion=!1;esAdmin=!1;ngOnInit(){let n=this.authService.currentUserValue;this.esAdmin=!!(n&&n.role_id===1),this.categoriaService.getCategorias().subscribe({next:e=>{this.categorias=e},error:()=>{this.categorias=[]}}),this.proveedorService.getProveedores().subscribe({next:e=>{this.proveedores=e},error:()=>{this.proveedores=[]}}),this.route.paramMap.subscribe(e=>{let t=e.get("id");t&&(this.esEdicion=!0,this.idProducto=+t,this.cargarProducto(this.idProducto))})}cargarProducto(n){this.productoService.getProducto(n).subscribe({next:e=>{this.productoForm.patchValue(e)},error:e=>{this.error="No se pudo cargar el producto"}})}onSubmit(){if(this.productoForm.valid){if(!this.authService.isAuthenticated()){this.error="Debes estar autenticado para crear un producto";return}this.submitting=!0,this.error="";let n=x(N({},this.productoForm.value),{precio:Number(this.productoForm.value.precio),stock:Number(this.productoForm.value.stock),stock_minimo:Number(this.productoForm.value.stock_minimo),categoria_id:Number(this.productoForm.value.categoria_id),proveedor_id:Number(this.productoForm.value.proveedor_id)});this.esEdicion&&this.idProducto?this.productoService.updateProducto(this.idProducto,n).subscribe({next:e=>{this.submitting=!1,this.router.navigate(["/productos"])},error:e=>{if(this.submitting=!1,e?.error?.message)this.error=e.error.message;else if(e?.error?.errors){let t=Object.keys(e.error.errors)[0];this.error=e.error.errors[t][0]}else this.error="Error al actualizar el producto"}}):this.productoService.createProducto(n).subscribe({next:e=>{this.submitting=!1,this.router.navigate(["/productos"])},error:e=>{if(this.submitting=!1,e?.error?.message)this.error=e.error.message;else if(e?.error?.errors){let t=Object.keys(e.error.errors)[0];this.error=e.error.errors[t][0]}else this.error="Error al crear el producto"}})}else this.error="Por favor, complete todos los campos requeridos correctamente.",Object.keys(this.productoForm.controls).forEach(n=>{let e=this.productoForm.get(n);e?.invalid&&e.markAsTouched()})}goBack(){this.router.navigate(["/productos"])}editarProducto(n){this.router.navigate(["/productos/editar",n])}static \u0275fac=function(e){return new(e||l)(p(X),p(ee),p(te),p(re),p(w),p(Z),p(M))};static \u0275cmp=O({type:l,selectors:[["app-producto-form"]],decls:72,vars:21,consts:[[1,"container"],[1,"card"],[1,"card-header","bg-primary","text-white"],[1,"mb-0"],[1,"card-body"],[1,"mt-4",3,"ngSubmit","formGroup"],["class","alert alert-danger alert-dismissible fade show","role","alert",4,"ngIf"],[1,"col-md-6"],[1,"mb-3"],["for","codigo",1,"form-label"],["type","text","id","codigo","formControlName","codigo",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","nombre",1,"form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["for","descripcion",1,"form-label"],["id","descripcion","formControlName","descripcion","rows","3",1,"form-control"],[1,"row"],["for","precio",1,"form-label"],[1,"input-group"],[1,"input-group-text"],["type","number","id","precio","formControlName","precio","step","0.01","min","0",1,"form-control"],["for","stock",1,"form-label"],["type","number","id","stock","formControlName","stock","min","0",1,"form-control"],["for","stock_minimo",1,"form-label"],["type","number","id","stock_minimo","formControlName","stock_minimo","min","0",1,"form-control"],["for","categoria_id",1,"form-label"],["id","categoria_id","formControlName","categoria_id","required","",1,"form-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-success",3,"click"],[1,"bi","bi-plus-lg"],["for","proveedor_id",1,"form-label"],["id","proveedor_id","formControlName","proveedor_id","required","",1,"form-select"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","alert",1,"alert","alert-danger","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"invalid-feedback"],[3,"value"]],template:function(e,t){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),i(4),r()(),o(5,"div",4)(6,"form",5),f("ngSubmit",function(){return t.onSubmit()}),u(7,ie,3,1,"div",6),o(8,"div",7)(9,"div",8)(10,"label",9),i(11,"C\xF3digo *"),r(),s(12,"input",10),u(13,ne,2,0,"div",11),r()(),o(14,"div",7)(15,"div",8)(16,"label",12),i(17,"Nombre *"),r(),s(18,"input",13),u(19,le,2,0,"div",11),r()(),o(20,"div",8)(21,"label",14),i(22,"Descripci\xF3n"),r(),s(23,"textarea",15),r(),o(24,"div",16)(25,"div",7)(26,"div",8)(27,"label",17),i(28,"Precio *"),r(),o(29,"div",18)(30,"span",19),i(31,"$"),r(),s(32,"input",20),r(),u(33,ae,2,0,"div",11),r()(),o(34,"div",7)(35,"div",8)(36,"label",21),i(37,"Stock Inicial *"),r(),s(38,"input",22),u(39,de,2,0,"div",11),r()()(),o(40,"div",8)(41,"label",23),i(42,"Stock M\xEDnimo *"),r(),s(43,"input",24),u(44,ce,2,0,"div",11),r(),o(45,"div",8)(46,"label",25),i(47,"Categor\xEDa *"),r(),o(48,"div",18)(49,"select",26)(50,"option",27),i(51,"Seleccione una categor\xEDa"),r(),u(52,me,2,2,"option",28),r(),o(53,"button",29),f("click",function(){return t.nuevaCategoria()}),s(54,"i",30),i(55," Nueva Categor\xEDa "),r()()(),o(56,"div",8)(57,"label",31),i(58,"Proveedor *"),r(),o(59,"div",18)(60,"select",32)(61,"option",27),i(62,"Seleccione un proveedor"),r(),u(63,ue,2,2,"option",28),r(),o(64,"button",29),f("click",function(){return t.nuevoProveedor()}),s(65,"i",30),i(66," Nuevo Proveedor "),r()()(),o(67,"div",33)(68,"button",34),f("click",function(){return t.goBack()}),i(69,"Cancelar"),r(),o(70,"button",35),i(71,"Guardar"),r()()()()()()),e&2){let m,b,g,_,h,P,S,C,F,k;a(4),E(t.esEdicion?"Editar Producto":"Nuevo Producto"),a(2),d("formGroup",t.productoForm),a(),d("ngIf",t.error),a(5),v("is-invalid",((m=t.productoForm.get("codigo"))==null?null:m.invalid)&&((m=t.productoForm.get("codigo"))==null?null:m.touched)),a(),d("ngIf",(b=t.productoForm.get("codigo"))==null||b.errors==null?null:b.errors.required),a(5),v("is-invalid",((g=t.productoForm.get("nombre"))==null?null:g.invalid)&&((g=t.productoForm.get("nombre"))==null?null:g.touched)),a(),d("ngIf",(_=t.productoForm.get("nombre"))==null||_.errors==null?null:_.errors.required),a(13),v("is-invalid",((h=t.productoForm.get("precio"))==null?null:h.invalid)&&((h=t.productoForm.get("precio"))==null?null:h.touched)),a(),d("ngIf",(P=t.productoForm.get("precio"))==null||P.errors==null?null:P.errors.required),a(5),v("is-invalid",((S=t.productoForm.get("stock"))==null?null:S.invalid)&&((S=t.productoForm.get("stock"))==null?null:S.touched)),a(),d("ngIf",(C=t.productoForm.get("stock"))==null||C.errors==null?null:C.errors.required),a(4),v("is-invalid",((F=t.productoForm.get("stock_minimo"))==null?null:F.invalid)&&((F=t.productoForm.get("stock_minimo"))==null?null:F.touched)),a(),d("ngIf",(k=t.productoForm.get("stock_minimo"))==null||k.errors==null?null:k.errors.required),a(8),d("ngForOf",t.categorias),a(11),d("ngForOf",t.proveedores),a(7),d("disabled",t.productoForm.invalid)}},dependencies:[j,D,V,Y,$,J,L,R,K,H,G,B,W,Q,z,U],styles:[".card-header[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.btn[_ngcontent-%COMP%]{margin:.5rem}"]})};export{oe as ProductoFormComponent};
